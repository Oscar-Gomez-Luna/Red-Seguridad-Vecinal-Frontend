trigger:
- master

pool:
  name: 'AgenteLocal'
  demands:
    - agent.name -equals LAPTOP-GLDNITHE

variables:
- group: SWA-Deployment-Secrets

jobs:
- job: BuildAndDeploy
  displayName: "Build and Deploy"
  steps:

  - checkout: self
    displayName: "Checkout code"

  - task: NodeTool@0
    inputs:
      versionSpec: '20.x'
    displayName: "Install Node.js"

  - script: |
      node --version
      npm --version
      yarn --version
    displayName: "Show versions"

  - script: yarn install --frozen-lockfile
    displayName: "Install dependencies"

  - script: yarn build
    displayName: "Build"
    env:
      CI: true
      NODE_ENV: production

  - script: dir dist
    displayName: "Verify dist"

  - task: AzureStaticWebApp@0
    inputs:
      app_location: '/'
      output_location: 'dist'
      azure_static_web_apps_api_token: $(SWA_DEPLOYMENT_TOKEN)
      skip_app_build: true
    displayName: "Deploy to SWA"